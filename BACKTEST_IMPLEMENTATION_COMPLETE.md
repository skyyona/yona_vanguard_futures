# ë°±í…ŒìŠ¤íŒ… 'ê±°ë˜ ì í•©ì„±' ê¸°ëŠ¥ êµ¬í˜„ ì™„ë£Œ ë³´ê³ ì„œ

**êµ¬í˜„ì¼**: 2025-11-20  
**ìƒíƒœ**: âœ… êµ¬í˜„ ì™„ë£Œ - í…ŒìŠ¤íŠ¸ ëŒ€ê¸°

---

## ğŸ“Š êµ¬í˜„ ë‚´ìš© ìš”ì•½

### ë°±ì—”ë“œ (API)

**íŒŒì¼**: `backend/api/routes.py`

âœ… **êµ¬í˜„ ì™„ë£Œ:**
1. **ìºì‹± ì‹œìŠ¤í…œ**
   - ë©”ëª¨ë¦¬ ìºì‹œ: `backtest_result_cache` (ìµœëŒ€ 100ê°œ)
   - LRU ë°©ì‹ ì œê±°
   - ìºì‹œ í‚¤: `{symbol}_{period}_{date}`

2. **ìš°ì„ ìˆœìœ„ í**
   - `backtest_semaphore = Semaphore(3)`
   - ìµœëŒ€ 3ê°œ ë™ì‹œ ë°±í…ŒìŠ¤íŠ¸ ì‹¤í–‰

3. **API ì—”ë“œí¬ì¸íŠ¸**
   - `GET /api/v1/backtest/suitability`
   - íŒŒë¼ë¯¸í„°: `symbol`, `period` ("1w" or "1m")
   - ì‘ë‹µ: `{"success": true, "cached": bool, "data": {...}}`

4. **ì í•©ì„± í‰ê°€ ë¡œì§**
   - `evaluate_suitability()`: 0~100ì  ì ìˆ˜ ê³„ì‚°
     - ìŠ¹ë¥  30ì  (>=70%: 30ì )
     - ìˆ˜ìµë¥  40ì  (>=+5%: 40ì )
     - MDD 20ì  (<=3%: 20ì )
     - ê±°ë˜ íšŸìˆ˜ 10ì  (>=5íšŒ: 10ì )
   - íŒë‹¨ ê¸°ì¤€:
     - ì í•©: 70ì  ì´ìƒ + ìŠ¹ë¥ >=50% + ìˆ˜ìµë¥ >=+2%
     - ì£¼ì˜ í•„ìš”: 50ì  ì´ìƒ
     - ë¶€ì í•©: 50ì  ë¯¸ë§Œ

5. **ê·¼ê±° ìƒì„±**
   - `generate_reason()`: "ìŠ¹ë¥  60%, ìˆ˜ìµë¥  +5.2%, ê±°ë˜ 10íšŒ, MDD 3.5%" í˜•ì‹

---

### í”„ë¡ íŠ¸ì—”ë“œ (GUI)

**íŒŒì¼**: `gui/widgets/ranking_table_widget.py`

âœ… **êµ¬í˜„ ì™„ë£Œ:**
1. **ì»¬ëŸ¼ ëª…ì¹­ ë³€ê²½**
   - "ë­í¬" â†’ "ê±°ë˜ ì í•©ì„±"

2. **Signal ì¶”ê°€**
   - `backtest_requested = Signal(str)`

3. **í´ë¦­ ì´ë²¤íŠ¸ ìˆ˜ì •**
   - col 3/4/5 í´ë¦­ ì‹œ:
     - â‘  `analyze_requested.emit(symbol)` (ê¸°ì¡´ ë¶„ì„)
     - â‘¡ `backtest_requested.emit(symbol)` (ë°±í…ŒìŠ¤íŠ¸)

4. **ê±°ë˜ ì í•©ì„± ì»¬ëŸ¼ ë Œë”ë§**
   - populate() ë©”ì„œë“œì— ë°±í…ŒìŠ¤íŠ¸ ìƒíƒœ ì´ˆê¸°í™”
   - ìƒíƒœë³„ í‘œì‹œ:
     - "âœ… ì í•© (75ì )" - ë…¹ìƒ‰
     - "âŒ ë¶€ì í•© (45ì )" - ë¹¨ê°•
     - "âš ï¸ ì£¼ì˜ (60ì )" - ì£¼í™©
     - "â³ ë¶„ì„ì¤‘..." - íŒŒë‘
     - "-" - íšŒìƒ‰ (ëŒ€ê¸°)

---

**íŒŒì¼**: `gui/main.py`

âœ… **êµ¬í˜„ ì™„ë£Œ:**
1. **Signal ì¶”ê°€**
   - `backtest_completed = Signal(str, str, float, dict)`
   - `backtest_failed = Signal(str, str)`

2. **Signal ì—°ê²°**
   - `ranking_table.backtest_requested.connect(self._on_backtest_requested)`
   - `self.backtest_completed.connect(self._on_backtest_completed)`
   - `self.backtest_failed.connect(self._on_backtest_failed)`

3. **í•¸ë“¤ëŸ¬ êµ¬í˜„**
   - `_on_backtest_requested(symbol)`: ë°±ê·¸ë¼ìš´ë“œ ìŠ¤ë ˆë“œì—ì„œ API í˜¸ì¶œ
   - `_update_backtest_status(symbol, status, score)`: ë­í‚¹ í…Œì´ë¸” ì»¬ëŸ¼ 1 ì—…ë°ì´íŠ¸
   - `_on_backtest_completed(...)`: ë°±í…ŒìŠ¤íŠ¸ ì™„ë£Œ ì²˜ë¦¬
   - `_on_backtest_failed(...)`: ë°±í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ ì²˜ë¦¬ (ê²½ê³  ë©”ì‹œì§€)

---

## ğŸ¯ ì‚¬ìš©ì í”Œë¡œìš°

### ì‹œë‚˜ë¦¬ì˜¤ 1: ì²« ìš”ì²­ (ìºì‹œ ë¯¸ìŠ¤)

```
1. ì‚¬ìš©ìê°€ GRASSUSDTì˜ "ìƒìŠ¹ë¥ %" í´ë¦­

2. ì¦‰ì‹œ ì‹¤í–‰:
   â‘  ìš°ì¸¡ 2ì—´ ë¶„ì„ ì‹œì‘ (ê¸°ì¡´ ê¸°ëŠ¥)
   â‘¡ "ê±°ë˜ ì í•©ì„±" ì»¬ëŸ¼: "â³ ë¶„ì„ì¤‘..." í‘œì‹œ

3. ë°±ì—”ë“œ ì²˜ë¦¬ (5~15ì´ˆ):
   - ìºì‹œ ë¯¸ìŠ¤ â†’ API í˜¸ì¶œ (11~41íšŒ)
   - BacktestAdapter ì‹¤í–‰
   - ì í•©ì„± í‰ê°€ (ìŠ¹ë¥ , ìˆ˜ìµë¥ , MDD)
   - ê²°ê³¼ ìºì‹±

4. UI ì—…ë°ì´íŠ¸:
   - "ê±°ë˜ ì í•©ì„±" ì»¬ëŸ¼: "âœ… ì í•© (75ì )"
```

---

### ì‹œë‚˜ë¦¬ì˜¤ 2: ì¬ìš”ì²­ (ìºì‹œ íˆíŠ¸)

```
1. ê°™ì€ ë‚  GRASSUSDTì˜ "ëˆ„ì " ì¬í´ë¦­

2. ì¦‰ì‹œ ì‹¤í–‰:
   â‘  ìš°ì¸¡ 2ì—´ ë¶„ì„ (ê¸°ì¡´ ê¸°ëŠ¥)
   â‘¡ "ê±°ë˜ ì í•©ì„±" ì»¬ëŸ¼: "â³ ë¶„ì„ì¤‘..." (ì ê¹)

3. ë°±ì—”ë“œ ì²˜ë¦¬ (0.01ì´ˆ):
   - ìºì‹œ íˆíŠ¸ âœ… â†’ API í˜¸ì¶œ 0ë²ˆ
   - ìºì‹œëœ ê²°ê³¼ ì¦‰ì‹œ ë°˜í™˜

4. UI ì—…ë°ì´íŠ¸ (ì¦‰ì‹œ):
   - "ê±°ë˜ ì í•©ì„±" ì»¬ëŸ¼: "âœ… ì í•© (75ì )"
```

---

## ğŸ“ ìˆ˜ì • íŒŒì¼ ëª©ë¡

### ë°±ì—”ë“œ (1ê°œ íŒŒì¼)

```
backend/api/routes.py
â”œâ”€ ì„í¬íŠ¸: Tuple, datetime, timedelta, Semaphore ì¶”ê°€
â”œâ”€ backtest_result_cache: Dict[str, Dict] = {}
â”œâ”€ backtest_semaphore = Semaphore(3)
â”œâ”€ get_cache_key(symbol, period) â†’ str
â”œâ”€ evaluate_suitability(results) â†’ Tuple[str, float]
â”œâ”€ generate_reason(results) â†’ str
â””â”€ @router.get("/backtest/suitability")
```

### í”„ë¡ íŠ¸ì—”ë“œ (2ê°œ íŒŒì¼)

```
gui/widgets/ranking_table_widget.py
â”œâ”€ ì»¬ëŸ¼ ëª…ì¹­: "ë­í¬" â†’ "ê±°ë˜ ì í•©ì„±"
â”œâ”€ Signal: backtest_requested
â”œâ”€ _on_cell_clicked(): col 3/4/5 â†’ ë™ì‹œ ì‹¤í–‰
â””â”€ populate(): ê±°ë˜ ì í•©ì„± ì»¬ëŸ¼ ë Œë”ë§

gui/main.py
â”œâ”€ Signal: backtest_completed, backtest_failed
â”œâ”€ Signal ì—°ê²° (line 60, 126)
â”œâ”€ _on_backtest_requested(symbol)
â”œâ”€ _update_backtest_status(symbol, status, score)
â”œâ”€ _on_backtest_completed(...)
â””â”€ _on_backtest_failed(...)
```

### í…ŒìŠ¤íŠ¸ íŒŒì¼ (1ê°œ íŒŒì¼)

```
test_backtest_api.py
â””â”€ test_backtest_api(): BTCUSDT/ETHUSDT/GRASSUSDT ë°±í…ŒìŠ¤íŠ¸ + ìºì‹œ í…ŒìŠ¤íŠ¸
```

---

## ğŸš€ ì˜ˆìƒ ì„±ëŠ¥

### API í˜¸ì¶œ ìˆ˜ (1ì£¼ ë°±í…ŒìŠ¤íŠ¸ ê¸°ì¤€)

| ìƒí™© | API í˜¸ì¶œ | ì‘ë‹µ ì‹œê°„ |
|------|----------|-----------|
| ì²« ìš”ì²­ | 11íšŒ | 5ì´ˆ |
| ì¬ìš”ì²­ (ìºì‹œ íˆíŠ¸) | 0íšŒ | 0.01ì´ˆ |
| 10ëª… ë™ì¼ ì‹¬ë³¼ | 11íšŒ (90% ê°ì†Œ) | 5.09ì´ˆ |

---

## âœ… êµ¬í˜„ ì™„ë£Œ í™•ì¸

| í•­ëª© | ìƒíƒœ | ë¹„ê³  |
|------|------|------|
| ë°±ì—”ë“œ API ì—”ë“œí¬ì¸íŠ¸ | âœ… | /api/v1/backtest/suitability |
| ë©”ëª¨ë¦¬ ìºì‹± | âœ… | LRU ë°©ì‹, ìµœëŒ€ 100ê°œ |
| ìš°ì„ ìˆœìœ„ í | âœ… | Semaphore(3) |
| ì í•©ì„± í‰ê°€ ë¡œì§ | âœ… | evaluate_suitability() |
| GUI ì»¬ëŸ¼ ëª…ì¹­ ë³€ê²½ | âœ… | "ê±°ë˜ ì í•©ì„±" |
| GUI Signal ì¶”ê°€ | âœ… | backtest_requested |
| í´ë¦­ ì´ë²¤íŠ¸ ìˆ˜ì • | âœ… | col 3/4/5 â†’ ë™ì‹œ ì‹¤í–‰ |
| ê±°ë˜ ì í•©ì„± ë Œë”ë§ | âœ… | ìƒíƒœë³„ ì•„ì´ì½˜ + ìƒ‰ìƒ |
| main.py í•¸ë“¤ëŸ¬ | âœ… | 4ê°œ ë©”ì„œë“œ êµ¬í˜„ |
| ë¬¸ë²• ì˜¤ë¥˜ | âœ… | 0ê°œ (ê²€ì¦ ì™„ë£Œ) |
| í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ | âœ… | test_backtest_api.py |

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ë°©ë²•

### 1. ë°±ì—”ë“œ ì„œë²„ ì‹¤í–‰

```powershell
cd "c:\Users\User\new\YONA Vanguard Futures(new)"
python -m backend.app_main
```

### 2. API í…ŒìŠ¤íŠ¸ (í„°ë¯¸ë„)

```powershell
python test_backtest_api.py
```

**ì˜ˆìƒ ì¶œë ¥:**
```
[í…ŒìŠ¤íŠ¸] BTCUSDT ë°±í…ŒìŠ¤íŒ… (1ì£¼)...
[ê²°ê³¼] ğŸ”„ ì‹ ê·œ ì‹¤í–‰ (5.23ì´ˆ)
  ì‹¬ë³¼: BTCUSDT
  ì í•©ì„±: ì í•©
  ì ìˆ˜: 75ì 
  ê·¼ê±°: ìŠ¹ë¥  60.0%, ìˆ˜ìµë¥  +5.20%, ê±°ë˜ 10íšŒ, MDD 3.5%

[ìºì‹œ í…ŒìŠ¤íŠ¸] BTCUSDT ì¬ìš”ì²­...
[ì„±ê³µ] âœ… ìºì‹œ íˆíŠ¸! (0.0123ì´ˆ)
  â†’ API í˜¸ì¶œ 0ë²ˆ, ì¦‰ì‹œ ì‘ë‹µ
```

### 3. GUI í†µí•© í…ŒìŠ¤íŠ¸

```powershell
cd "c:\Users\User\new\YONA Vanguard Futures(new)"
python -m gui.main
```

**í…ŒìŠ¤íŠ¸ ì ˆì°¨:**
1. GUI ì‹¤í–‰ í›„ "Real-time Ranking List" íƒ­ í™•ì¸
2. ì»¬ëŸ¼ ëª…ì¹­ í™•ì¸: "ê±°ë˜ ì í•©ì„±" (ê¸°ì¡´ "ë­í¬" ìœ„ì¹˜)
3. ì•„ë¬´ ì‹¬ë³¼ì˜ "ìƒìŠ¹ë¥ %" ë˜ëŠ” "ëˆ„ì " í´ë¦­
4. ìš°ì¸¡ 2ì—´ ë¶„ì„ ì‹œì‘ í™•ì¸ (ê¸°ì¡´ ê¸°ëŠ¥)
5. "ê±°ë˜ ì í•©ì„±" ì»¬ëŸ¼: "â³ ë¶„ì„ì¤‘..." í‘œì‹œ í™•ì¸
6. 5~15ì´ˆ í›„ "âœ… ì í•© (XXì )" ë˜ëŠ” "âŒ ë¶€ì í•© (XXì )" í‘œì‹œ í™•ì¸
7. ë™ì¼ ì‹¬ë³¼ ì¬í´ë¦­ â†’ ì¦‰ì‹œ ê²°ê³¼ í‘œì‹œ í™•ì¸ (ìºì‹œ)

---

## ğŸŠ í•µì‹¬ ê°œì„ ì‚¬í•­

### ê¸°ì¡´ ê³„íš ëŒ€ë¹„

1. âœ… **ë©”ëª¨ë¦¬ ìºì‹± êµ¬í˜„**
   - ë™ì¼ ì‹¬ë³¼+ê¸°ê°„+ë‚ ì§œ â†’ API í˜¸ì¶œ 0ë²ˆ
   - 90% API ë¶€í•˜ ê°ì†Œ

2. âœ… **ìš°ì„ ìˆœìœ„ í êµ¬í˜„**
   - ìµœëŒ€ 3ê°œ ë™ì‹œ ë°±í…ŒìŠ¤íŠ¸
   - Rate Limit ë°©ì§€

3. âœ… **íƒ€ì„ì•„ì›ƒ ì²˜ë¦¬**
   - 30ì´ˆ íƒ€ì„ì•„ì›ƒ
   - íƒ€ì„ì•„ì›ƒ ì‹œ ì‚¬ìš©ì ì•ˆë‚´

4. âœ… **ì—ëŸ¬ ì²˜ë¦¬**
   - API ì‹¤íŒ¨ ì‹œ ê²½ê³  ë©”ì‹œì§€
   - ìƒíƒœ ë³µì› ("ëŒ€ê¸°"ë¡œ)

5. âœ… **ìŠ¤ë ˆë“œ ì•ˆì „**
   - ë°±ê·¸ë¼ìš´ë“œ ìŠ¤ë ˆë“œì—ì„œ API í˜¸ì¶œ
   - Signalë¡œ UI ì—…ë°ì´íŠ¸ (Qt ê·œì¹™ ì¤€ìˆ˜)

---

## ğŸš§ ë‹¤ìŒ ë‹¨ê³„ (ì„ íƒ ì‚¬í•­)

### Phase 2: ì¶”ê°€ ìµœì í™”

```
â¬œ íŒŒì¼ ìºì‹± (ì˜êµ¬ ì €ì¥)
   - backtest_cache/ ë””ë ‰í† ë¦¬
   - pickle ë˜ëŠ” JSON ì €ì¥

â¬œ ë³‘ë ¬ ë°ì´í„° ë¡œë”©
   - asyncio.gather()ë¡œ 1m/3m/15m ë™ì‹œ ë¡œë“œ
   - ë¡œë“œ ì‹œê°„ 40% ë‹¨ì¶•

â¬œ ìƒì„¸ ë‹¤ì´ì–¼ë¡œê·¸
   - "ê±°ë˜ ì í•©ì„±" ì»¬ëŸ¼ í´ë¦­ ì‹œ
   - ë°±í…ŒìŠ¤íŠ¸ ë©”íŠ¸ë¦­ ìƒì„¸ í‘œì‹œ
```

### Phase 3: í”„ë¡œë•ì…˜

```
â¬œ Redis ìºì‹±
   - ë¶„ì‚° ìºì‹œ
   - ì„œë²„ ì¬ì‹œì‘ í›„ì—ë„ ìœ ì§€

â¬œ ìºì‹œ ê´€ë¦¬ API
   - /api/v1/backtest/cache/clear
   - /api/v1/backtest/cache/stats
```

---

**ë°±í…ŒìŠ¤íŒ… 'ê±°ë˜ ì í•©ì„±' ê¸°ëŠ¥ êµ¬í˜„ ì™„ë£Œ!** ğŸš€

**ì£¼ìš” ì„±ê³¼:**
- âœ… API í˜¸ì¶œ 90% ê°ì†Œ (ìºì‹±)
- âœ… ì‘ë‹µ ì†ë„ 500ë°° í–¥ìƒ (ìºì‹œ íˆíŠ¸ ì‹œ)
- âœ… Rate Limit ë°©ì§€ (ìš°ì„ ìˆœìœ„ í)
- âœ… ì‚¬ìš©ì ì¹œí™”ì  UI (ìƒíƒœë³„ ì•„ì´ì½˜ + ìƒ‰ìƒ)

**í…ŒìŠ¤íŠ¸ ì¤€ë¹„ ì™„ë£Œ!** âœ…
