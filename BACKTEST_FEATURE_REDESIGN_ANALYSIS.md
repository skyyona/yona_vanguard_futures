# 🔬 백테스팅 기능 재설계 분석 보고서

**분석 일시**: 2025-11-20  
**분석 목적**: 사용자 요구사항 정확한 이해 및 재설계 방향 수립  
**현재 상태**: 구현 작업 진행하지 않음 (분석 및 보고만)

---

## 📊 사용자 요구사항 분석

### 현재 상황

**1. 현재 백테스팅 기능 상태**
- ❌ 정상 작동하지 않음
- 구현은 되어 있으나 실제 동작에 문제 존재

**2. 현재 작동 방식**
- 사용자가 랭킹 리스트의 코인 심볼(4/5/6번째 컬럼) 클릭
- 클릭한 코인에 대해 백테스팅 실행
- 결과를 "거래 적합성" 컬럼(2번째)에 표시

**3. 현재 방식의 문제점**

#### 문제점 A: 수동적 방식
- **사용자가 직접 클릭**해야만 백테스팅 실행
- 500개 이상의 코인을 모두 확인하려면 수백 번 클릭 필요
- 실시간으로 변화하는 시장 상황을 놓치기 쉬움

#### 문제점 B: 엔진별 적합성 평가 부족
- 현재는 **단일 전략**으로만 백테스팅 (Alpha 전략 기준)
- 3개 엔진 (Alpha, Beta, Gamma) 각각의 특성이 다름:
  - **Alpha**: 스캘핑 (1분봉, 빠른 진입/청산)
  - **Beta**: 데이 트레이딩 (5분봉, 중간 거래)
  - **Gamma**: 스윙 트레이딩 (1시간봉, 장기 보유)
- 같은 코인이라도 **엔진별로 적합성**이 다를 수 있음
- 현재는 모든 코인을 같은 기준으로 평가

#### 문제점 C: 신뢰도 및 수익률 문제
- 500개 이상의 코인을 단 3개 엔진에 맞춰 평가하는 것은 **부정확**
- 각 코인의 특성 (변동성, 거래량, 추세 패턴 등)을 고려하지 못함
- 엔진별 최적화가 되지 않아 **신뢰도가 떨어짐**
- 결과적으로 **수익률도 기대에 못 미침**

---

## 🎯 사용자 의도 추론 및 분석

### 핵심 요구사항

**"해당 기능과 우리 앱의 엔진을 다음과 같이 새롭게 구현했으면 좋겠어!!"**

사용자가 원하는 방향성 (추론):

### 1. 자동화된 백테스팅 시스템

**기존 방식:**
```
사용자 클릭 → 해당 코인 백테스팅 → 결과 표시
```

**새로운 방식 (추론):**
```
자동 스캔 → 모든 코인 백테스팅 → 엔진별 적합성 평가 → 결과 표시
```

**장점:**
- 수동 작업 제거
- 실시간 시장 변화 대응
- 모든 코인 자동 평가

### 2. 엔진별 적합성 평가

**기존 방식:**
```
단일 전략 (Alpha 기준) → 모든 코인 평가
```

**새로운 방식 (추론):**
```
3개 엔진 (Alpha/Beta/Gamma) → 각 코인을 엔진별로 평가
```

**예시:**
- **Alpha 엔진 적합 코인**: 변동성이 높고, 단기 스캘핑에 적합
- **Beta 엔진 적합 코인**: 중기 추세가 명확하고, 거래량이 안정적
- **Gamma 엔진 적합 코인**: 장기 상승 추세가 확고하고, 변동성이 낮음

**장점:**
- 엔진별 최적화된 코인 선택
- 각 엔진의 특성에 맞는 코인 매칭
- 신뢰도 및 수익률 향상

### 3. 효율적인 필터링 및 우선순위

**기존 방식:**
```
500개 코인 → 모두 동일한 방식으로 평가
```

**새로운 방식 (추론):**
```
500개 코인 → 1차 필터링 (거래량, 변동성 등) → 2차 엔진별 평가 → 우선순위 부여
```

**필터링 기준 (추론):**
1. **1차 필터링**: 기본 조건
   - 최소 거래량
   - 최소 변동성
   - 상장 기간 (신규 상장 제외 또는 포함)

2. **2차 엔진별 평가**: 엔진 특성에 맞는 평가
   - **Alpha**: 단기 변동성, 거래량 급증
   - **Beta**: 중기 추세, 거래량 안정성
   - **Gamma**: 장기 추세, 변동성 낮음

3. **우선순위 부여**: 점수 기준 정렬
   - 각 엔진별로 적합한 코인 순위 매김
   - 상위 N개만 실제 거래 대상으로 선택

---

## 🔍 현재 앱 구조 분석

### 1. 엔진 구조

#### Alpha 엔진
- **전략**: 스캘핑
- **시간 프레임**: 1분봉
- **자본 배분**: 100 USDT
- **레버리지**: 5x
- **익절**: 3.7%
- **손절**: 0.5%
- **특징**: 빠른 진입/청산, 높은 거래 빈도

#### Beta 엔진
- **전략**: 데이 트레이딩
- **시간 프레임**: 5분봉
- **자본 배분**: 200 USDT
- **레버리지**: 3x
- **익절**: 5.0%
- **손절**: 0.5%
- **특징**: 중간 거래 빈도, 추세 추종

#### Gamma 엔진
- **전략**: 스윙 트레이딩
- **시간 프레임**: 1시간봉
- **자본 배분**: 300 USDT
- **레버리지**: 2x
- **익절**: 8.5%
- **손절**: 0.5%
- **특징**: 낮은 거래 빈도, 큰 수익 목표

### 2. 랭킹 리스트 구조

**현재 표시 항목:**
1. 선택 (체크박스)
2. 거래 적합성 (백테스트 결과)
3. 코인 심볼
4. 상승률%
5. 누적
6. 상승 유형

**데이터 소스:**
- 바이낸스 24시간 티커 데이터
- 상위 100개 코인 표시
- 실시간 업데이트

**문제점:**
- "거래 적합성"은 사용자가 클릭한 코인만 표시
- 자동으로 모든 코인 평가하지 않음

### 3. 현재 백테스팅 API

**엔드포인트**: `GET /api/v1/backtest/suitability`

**파라미터:**
- `symbol`: 코인 심볼
- `period`: 백테스트 기간 ("1w" or "1m")

**현재 로직:**
- 단일 코인만 백테스팅
- Alpha 전략 기준으로 평가
- 결과를 적합/부적합/주의 필요로 판단

**한계:**
- 엔진별 평가 없음
- 자동 스캔 없음
- 우선순위 시스템 없음

---

## 💡 새로운 구현 방향 제안

### 방향 1: 자동 스캔 백테스팅 시스템

#### 1.1 자동 스캔 엔진

**구현 내용:**
- 주기적으로 (예: 5분마다) 랭킹 리스트 상위 코인 자동 스캔
- 각 코인에 대해 백테스팅 실행
- 결과를 실시간으로 업데이트

**장점:**
- 사용자 개입 없이 자동 평가
- 실시간 시장 변화 대응
- 모든 코인 자동 평가

**단점:**
- API 호출 부하 증가
- 서버 리소스 사용 증가

#### 1.2 배치 처리 시스템

**구현 내용:**
- 백그라운드에서 주기적으로 실행
- 우선순위 큐로 관리
- 최대 동시 실행 제한 (현재 3개)

**최적화:**
- 캐싱 시스템 활용
- 동일 심볼 재평가 방지 (일정 시간 내)
- 우선순위 기반 처리

### 방향 2: 엔진별 적합성 평가

#### 2.1 엔진별 백테스팅

**구현 내용:**
- 각 코인을 3개 엔진 (Alpha/Beta/Gamma)별로 평가
- 각 엔진의 전략 특성에 맞는 백테스트 실행
- 엔진별 점수 및 적합성 판단

**평가 방식:**
```python
# 예시 구조
{
    "BTCUSDT": {
        "alpha": {
            "suitability": "적합",
            "score": 85.0,
            "metrics": {...}
        },
        "beta": {
            "suitability": "주의 필요",
            "score": 55.0,
            "metrics": {...}
        },
        "gamma": {
            "suitability": "부적합",
            "score": 30.0,
            "metrics": {...}
        }
    }
}
```

**GUI 표시 방식:**
- 랭킹 테이블에 엔진별 컬럼 추가
- 또는 "거래 적합성" 컬럼에 최적 엔진 표시
- 예: "✅ Alpha 적합 (85점)" 또는 "⚠️ Beta 주의 (55점)"

#### 2.2 엔진별 최적 코인 추천

**구현 내용:**
- 각 엔진에 가장 적합한 코인 Top N개 추천
- 실시간으로 업데이트
- 엔진별로 별도 랭킹 제공

**사용 예시:**
- Alpha 엔진: 변동성이 높은 코인 우선
- Beta 엔진: 중기 추세가 명확한 코인 우선
- Gamma 엔진: 장기 상승 추세가 확고한 코인 우선

### 방향 3: 효율적인 필터링 시스템

#### 3.1 1차 필터링

**기준:**
- 최소 거래량 (24시간 기준)
- 최소 변동성 (상승률%)
- 상장 기간 (신규 상장 제외 옵션)

**목적:**
- 불필요한 백테스트 제거
- 리소스 절약
- 의미 있는 코인만 평가

#### 3.2 2차 엔진별 평가

**기준:**
- 각 엔진의 전략 특성에 맞는 평가
- 엔진별 지표 계산
- 엔진별 점수 부여

**예시:**
- **Alpha**: 단기 변동성, 거래량 급증, RSI 과매도
- **Beta**: 중기 추세, MACD 골든크로스, 볼린저 밴드
- **Gamma**: 장기 추세, EMA 200, 지지선 테스트

#### 3.3 우선순위 시스템

**구현 내용:**
- 각 코인에 엔진별 점수 부여
- 점수 기준 정렬
- 상위 N개만 실제 거래 대상으로 선택

**우선순위 기준:**
1. 적합성 점수 (높을수록 우선)
2. 예상 수익률 (높을수록 우선)
3. 리스크 (낮을수록 우선)
4. 거래량 (높을수록 우선)

---

## 📋 구현 계획 제안

### Phase 1: 백엔드 API 확장

#### 1.1 엔진별 백테스팅 API

**새로운 엔드포인트:**
```
GET /api/v1/backtest/suitability/engine
```

**파라미터:**
- `symbol`: 코인 심볼
- `engine`: 엔진명 ("Alpha", "Beta", "Gamma")
- `period`: 백테스트 기간 ("1w" or "1m")

**응답:**
```json
{
    "success": true,
    "engine": "Alpha",
    "data": {
        "symbol": "BTCUSDT",
        "suitability": "적합",
        "score": 85.0,
        "metrics": {...}
    }
}
```

#### 1.2 배치 백테스팅 API

**새로운 엔드포인트:**
```
POST /api/v1/backtest/batch
```

**요청:**
```json
{
    "symbols": ["BTCUSDT", "ETHUSDT", ...],
    "engines": ["Alpha", "Beta", "Gamma"],
    "period": "1w"
}
```

**응답:**
```json
{
    "success": true,
    "results": {
        "BTCUSDT": {
            "alpha": {...},
            "beta": {...},
            "gamma": {...}
        },
        ...
    }
}
```

### Phase 2: 자동 스캔 시스템

#### 2.1 백그라운드 스캔 서비스

**구현 내용:**
- 주기적으로 (예: 5분마다) 실행
- 랭킹 리스트 상위 코인 자동 스캔
- 배치 백테스팅 실행
- 결과를 캐시에 저장

#### 2.2 우선순위 큐 관리

**구현 내용:**
- 동시 실행 제한 (현재 3개)
- 우선순위 기반 처리
- 실패 시 재시도 로직

### Phase 3: GUI 개선

#### 3.1 엔진별 컬럼 추가

**옵션 A: 컬럼 추가**
- "Alpha 적합성", "Beta 적합성", "Gamma 적합성" 컬럼 추가
- 각 컬럼에 엔진별 적합성 표시

**옵션 B: 최적 엔진 표시**
- "거래 적합성" 컬럼에 가장 적합한 엔진 표시
- 예: "✅ Alpha 적합 (85점)"

#### 3.2 엔진별 추천 코인 뷰

**구현 내용:**
- 각 엔진별로 가장 적합한 코인 Top 10 표시
- 별도 탭 또는 위젯으로 제공
- 실시간 업데이트

---

## 🎯 핵심 개선 사항 요약

### 1. 자동화
- ❌ 수동 클릭 방식
- ✅ 자동 스캔 및 백테스팅

### 2. 엔진별 평가
- ❌ 단일 전략 기준
- ✅ 3개 엔진별 적합성 평가

### 3. 효율성
- ❌ 500개 코인 모두 동일 평가
- ✅ 필터링 및 우선순위 기반 평가

### 4. 신뢰도
- ❌ 부정확한 적합성 판단
- ✅ 엔진별 최적화된 판단

### 5. 수익률
- ❌ 엔진 특성 무시
- ✅ 엔진별 최적 코인 선택

---

## ❓ 확인이 필요한 사항

### 사용자 의도 확인 필요

1. **자동 스캔 주기**
   - 얼마나 자주 실행할지? (5분? 10분? 1시간?)

2. **스캔 대상**
   - 랭킹 리스트 상위 몇 개? (100개? 200개?)
   - 필터링 기준은?

3. **GUI 표시 방식**
   - 엔진별 컬럼 추가?
   - 최적 엔진만 표시?
   - 별도 추천 뷰?

4. **우선순위 시스템**
   - 각 엔진별로 최대 몇 개 코인 선택?
   - 점수 기준 임계값은?

5. **성능 최적화**
   - API 호출 제한은?
   - 캐싱 전략은?

---

## 📝 다음 단계

### 1. 사용자 의도 확인
- 구체적인 요구사항 명확화
- 우선순위 확인
- 성능 요구사항 확인

### 2. 상세 설계
- API 구조 설계
- 데이터 구조 설계
- GUI 구조 설계

### 3. 구현 계획 수립
- 단계별 구현 계획
- 우선순위 설정
- 일정 수립

---

**분석 완료일**: 2025-11-20  
**분석자**: AI Assistant  
**다음 작업**: 사용자 의도 확인 및 상세 요구사항 수집


